<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã“ã®è‰²ã¯ä½•ç•ªï¼Ÿæ—©æŠ¼ã—ã‚²ãƒ¼ãƒ </title>
    
    <style>
        /* style.cssã®å†…å®¹ã‚’ã“ã“ã«çµ±åˆ */
        body {
            font-family: 'Helvetica Neue', Arial, 'Hiragino Kaku Gothic ProN', 'Hiragino Sans', Meiryo, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background-color: #f0f2f5;
            color: #333;
        }

        #game-container {
            width: 360px;
            padding: 20px;
            background-color: #fff;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        h1 {
            /* â˜…â˜…â˜… å¤‰æ›´: clamp()ã§ãƒ•ã‚©ãƒ³ãƒˆã‚µã‚¤ã‚ºã‚’å¯å¤‰ã« â˜…â˜…â˜… */
            font-size: clamp(1.3em, 5.5vw, 1.8em); 
            color: #0056b3;
            white-space: nowrap; /* 1è¡Œè¡¨ç¤ºã®æŒ‡å®šã¯ãã®ã¾ã¾ */
        }

        h2 {
            font-size: 1.5em;
            color: #d9534f;
        }

        #start-screen {
            text-align: left;
        }

        .hidden {
            display: none;
        }

        #status-bar {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            font-weight: bold;
            margin-bottom: 20px;
        }

        .score-container {
            text-align: left;
        }

        #high-score {
            font-size: 0.9em;
            color: #6c757d;
            margin-bottom: 4px;
        }

        #score {
            font-size: 1.2em;
            color: #0056b3;
        }
        
        #question-area {
            margin: 10px 0;
        }

        #color-display {
            font-size: 2.5em;
            font-weight: bold;
            padding: 20px;
            margin: 10px auto;
            border: 2px solid #ddd;
            border-radius: 8px;
            min-height: 60px;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        #feedback {
            font-size: 1.2em;
            font-weight: bold;
            height: 50px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .correct {
            color: #5cb85c;
        }

        .incorrect {
            color: #d9534f;
        }
        
        #new-high-score-message {
            color: #d9534f;
            font-weight: bold;
            font-size: 1.1em;
        }

        #keypad {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }

        #keypad button {
            padding: 20px;
            font-size: 1.5em;
            border: 1px solid #ccc;
            border-radius: 8px;
            background-color: #f8f9fa;
            cursor: pointer;
            transition: background-color 0.2s, transform 0.1s;
        }

        #keypad button:hover {
            background-color: #e9ecef;
        }

        #keypad button:active {
            transform: scale(0.95);
        }

        #keypad button[data-number="0"] {
            grid-column: 2 / 3;
        }

        button#start-button, button#restart-button {
            width: 100%;
            padding: 15px;
            font-size: 1.2em;
            color: #fff;
            background-color: #007bff;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            margin-top: 20px;
        }

        button#start-button:hover, button#restart-button:hover {
            background-color: #0056b3;
        }

        /* ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ç”¨ã®ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–è¨­å®š */
        @media (max-width: 480px) {
            body {
                align-items: flex-start;
                padding-top: 10px;
                padding-bottom: 20px;
            }

            #game-container {
                width: 95%;
                padding: 10px;
            }

            h1 {
                /* font-sizeã¯clamp()ã§åˆ¶å¾¡ã•ã‚Œã‚‹ãŸã‚ã€ã“ã“ã§ã¯ãƒãƒ¼ã‚¸ãƒ³ã®ã¿èª¿æ•´ */
                margin-top: 5px;
                margin-bottom: 15px;
            }

            #status-bar,
            #question-area {
                margin-bottom: 10px;
            }
            
            #question-area {
                margin: 10px 0;
            }

            #color-display {
                font-size: 2em;
                padding: 12px;
                min-height: auto;
            }

            #feedback {
                height: 35px;
                font-size: 1em;
                margin-bottom: 10px;
            }

            #keypad button {
                padding: 12px;
                font-size: 1.4em;
            }

            #keypad {
                gap: 8px;
            }

            button#start-button, button#restart-button {
                padding: 12px;
                font-size: 1.1em;
            }
        }
    </style>
</head>
<body>

    <div id="game-container">
        <h1>ã“ã®è‰²ã¯ä½•ç•ªï¼Ÿæ—©æŠ¼ã—ã‚²ãƒ¼ãƒ </h1>

        <div id="start-screen">
            <p>ç”»é¢ã«è¡¨ç¤ºã•ã‚Œã‚‹è‰²ã®ç•ªå·ã‚’ã€ãƒ‘ãƒƒãƒ‰ã§ç´ æ—©ãå…¥åŠ›ã—ã¦ãã ã•ã„ã€‚</p>
            <p>åˆ¶é™æ™‚é–“ã¯60ç§’ã€‚æ­£è§£ã§+10ç‚¹ã€ä¸æ­£è§£ã§-10ç‚¹ã§ã™ã€‚</p>
            <button id="start-button">ã‚²ãƒ¼ãƒ ã‚¹ã‚¿ãƒ¼ãƒˆï¼</button>
        </div>

        <div id="game-screen" class="hidden">
            <div id="status-bar">
                <div class="score-container">
                    <div id="high-score">æœ¬æ—¥ã®æœ€é«˜å¾—ç‚¹: 0ç‚¹</div>
                    <div id="score">ã‚¹ã‚³ã‚¢: 0ç‚¹</div>
                </div>
                <div id="timer">æ®‹ã‚Šæ™‚é–“: 60ç§’</div>
            </div>
            <div id="question-area">
                <div id="color-display"></div>
            </div>
            <div id="feedback"></div>
            <div id="keypad">
                <button data-number="1">1</button>
                <button data-number="2">2</button>
                <button data-number="3">3</button>
                <button data-number="4">4</button>
                <button data-number="5">5</button>
                <button data-number="6">6</button>
                <button data-number="7">7</button>
                <button data-number="8">8</button>
                <button data-number="9">9</button>
                <button data-number="0">0</button>
            </div>
        </div>

        <div id="end-screen" class="hidden">
            <h2>æ™‚é–“åˆ‡ã‚Œï¼</h2>
            <p id="final-score"></p>
            <p id="new-high-score-message" class="hidden"></p>
            <button id="restart-button">ã‚‚ã†ä¸€åº¦ãƒ—ãƒ¬ã‚¤</button>
        </div>
    </div>

    <script>
        // script.jsã®å†…å®¹ã‚’ã“ã“ã«çµ±åˆ
        document.addEventListener('DOMContentLoaded', () => {
            const COLOR_CODES = {
                'é»’': { value: 0, hex: '#000000', textColor: '#FFFFFF' }, 'èŒ¶': { value: 1, hex: '#8B4513', textColor: '#FFFFFF' },
                'èµ¤': { value: 2, hex: '#FF0000', textColor: '#FFFFFF' }, 'æ©™': { value: 3, hex: '#FFA500', textColor: '#000000' },
                'é»„': { value: 4, hex: '#FFFF00', textColor: '#000000' }, 'ç·‘': { value: 5, hex: '#008000', textColor: '#FFFFFF' },
                'é’': { value: 6, hex: '#0000FF', textColor: '#FFFFFF' }, 'ç´«': { value: 7, hex: '#800080', textColor: '#FFFFFF' },
                'ç°': { value: 8, hex: '#808080', textColor: '#FFFFFF' }, 'ç™½': { value: 9, hex: '#FFFFFF', textColor: '#000000' }
            };
            const TIME_LIMIT = 60;
            const CORRECT_SCORE = 10;
            const INCORRECT_SCORE = -10;

            const startScreen = document.getElementById('start-screen');
            const gameScreen = document.getElementById('game-screen');
            const endScreen = document.getElementById('end-screen');
            const startButton = document.getElementById('start-button');
            const restartButton = document.getElementById('restart-button');
            const scoreDisplay = document.getElementById('score');
            const timerDisplay = document.getElementById('timer');
            const colorDisplay = document.getElementById('color-display');
            const keypad = document.getElementById('keypad');
            const feedbackDisplay = document.getElementById('feedback');
            const finalScoreDisplay = document.getElementById('final-score');
            const highScoreDisplay = document.getElementById('high-score');
            const newHighScoreMessage = document.getElementById('new-high-score-message');

            let score = 0;
            let timeLeft = TIME_LIMIT;
            let timerId = null;
            let currentCorrectAnswer = null;
            const colorNames = Object.keys(COLOR_CODES);
            let highScore = 0;

            function loadHighScore() {
                const storedData = localStorage.getItem('resistorGameHighScore');
                if (storedData) {
                    try {
                        const data = JSON.parse(storedData);
                        const today = new Date().toISOString().slice(0, 10);
                        if (data.date === today) {
                            highScore = data.score;
                        }
                    } catch (e) {
                        console.error("Failed to parse high score data:", e);
                        highScore = 0;
                    }
                }
                highScoreDisplay.textContent = `æœ¬æ—¥ã®æœ€é«˜å¾—ç‚¹: ${highScore}ç‚¹`;
            }

            function saveHighScore() {
                const today = new Date().toISOString().slice(0, 10);
                const data = {
                    score: highScore,
                    date: today
                };
                localStorage.setItem('resistorGameHighScore', JSON.stringify(data));
            }

            function startGame() {
                clearInterval(timerId);
                score = 0;
                timeLeft = TIME_LIMIT;
                scoreDisplay.textContent = `ã‚¹ã‚³ã‚¢: ${score}ç‚¹`;
                timerDisplay.textContent = `æ®‹ã‚Šæ™‚é–“: ${timeLeft}ç§’`;
                feedbackDisplay.textContent = '';
                newHighScoreMessage.classList.add('hidden');
                startScreen.classList.add('hidden');
                endScreen.classList.add('hidden');
                gameScreen.classList.remove('hidden');
                runCountdown();
            }

            function runCountdown() {
                let countdown = 3;
                keypad.querySelectorAll('button').forEach(button => button.disabled = true);
                colorDisplay.style.backgroundColor = '#f8f9fa';
                colorDisplay.style.color = '#333333';
                const countdownInterval = setInterval(() => {
                    if (countdown > 0) {
                        colorDisplay.textContent = countdown;
                        countdown--;
                    } else {
                        clearInterval(countdownInterval);
                        keypad.querySelectorAll('button').forEach(button => button.disabled = false);
                        startMainTimer();
                        generateNewQuestion();
                    }
                }, 1000);
            }

            function startMainTimer() {
                timerId = setInterval(() => {
                    timeLeft--;
                    timerDisplay.textContent = `æ®‹ã‚Šæ™‚é–“: ${timeLeft}ç§’`;
                    if (timeLeft <= 0) {
                        endGame();
                    }
                }, 1000);
            }

            function endGame() {
                clearInterval(timerId);
                gameScreen.classList.add('hidden');
                endScreen.classList.remove('hidden');
                finalScoreDisplay.textContent = `æœ€çµ‚ã‚¹ã‚³ã‚¢ã¯ ${score} ç‚¹ã§ã—ãŸï¼`;

                if (score > highScore) {
                    highScore = score;
                    highScoreDisplay.textContent = `æœ¬æ—¥ã®æœ€é«˜å¾—ç‚¹: ${highScore}ç‚¹`;
                    newHighScoreMessage.textContent = "ğŸ‰ æœ¬æ—¥ã®æœ€é«˜å¾—ç‚¹ã‚’æ›´æ–°ã—ã¾ã—ãŸï¼ ğŸ‰";
                    newHighScoreMessage.classList.remove('hidden');
                    saveHighScore();
                }
            }

            function generateNewQuestion() {
                const randomColorName = colorNames[Math.floor(Math.random() * colorNames.length)];
                const colorData = COLOR_CODES[randomColorName];
                currentCorrectAnswer = colorData.value;
                colorDisplay.textContent = randomColorName;
                colorDisplay.style.backgroundColor = colorData.hex;
                colorDisplay.style.color = colorData.textColor;
            }

            function checkAnswer(userAnswer) {
                keypad.querySelectorAll('button').forEach(button => button.disabled = true);
                feedbackDisplay.classList.remove('correct', 'incorrect');
                if (userAnswer === currentCorrectAnswer) {
                    score += CORRECT_SCORE;
                    feedbackDisplay.textContent = `æ­£è§£ï¼+${CORRECT_SCORE}ç‚¹`;
                    feedbackDisplay.classList.add('correct');
                } else {
                    const correctAnswerName = Object.keys(COLOR_CODES).find(key => COLOR_CODES[key].value === currentCorrectAnswer);
                    score += INCORRECT_SCORE;
                    feedbackDisplay.textContent = `ä¸æ­£è§£... ${correctAnswerName}ã¯ ${currentCorrectAnswer}`;
                    feedbackDisplay.classList.add('incorrect');
                }
                scoreDisplay.textContent = `ã‚¹ã‚³ã‚¢: ${score}ç‚¹`;
                setTimeout(() => {
                    feedbackDisplay.textContent = '';
                    generateNewQuestion();
                    if (timeLeft > 0) {
                        keypad.querySelectorAll('button').forEach(button => button.disabled = false);
                    }
                }, 800);
            }
            
            startButton.addEventListener('click', startGame);
            restartButton.addEventListener('click', startGame);
            keypad.addEventListener('click', (event) => {
                if (event.target.tagName !== 'BUTTON' || event.target.disabled) return;
                const userAnswer = parseInt(event.target.dataset.number, 10);
                checkAnswer(userAnswer);
            });

            loadHighScore();
        });
    </script>

</body>
</html>